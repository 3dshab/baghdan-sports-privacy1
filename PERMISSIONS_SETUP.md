# إعداد الأذونات - Permissions Setup

## نظرة عامة
تم إضافة نظام طلب الأذونات عند أول تشغيل للتطبيق لتحسين تجربة المستخدم وضمان عمل جميع الميزات بشكل صحيح.

## الأذونات المطلوبة

### Android
- **READ_EXTERNAL_STORAGE**: قراءة الملفات من التخزين الخارجي
- **WRITE_EXTERNAL_STORAGE**: كتابة الملفات (Android 12 وأقل)
- **READ_MEDIA_IMAGES**: قراءة الصور (Android 13+)
- **READ_MEDIA_VIDEO**: قراءة الفيديوهات (Android 13+)
- **CAMERA**: الوصول إلى الكاميرا
- **POST_NOTIFICATIONS**: إرسال الإشعارات (Android 13+)

### iOS
- **NSPhotoLibraryUsageDescription**: الوصول إلى مكتبة الصور
- **NSPhotoLibraryAddUsageDescription**: حفظ الصور
- **NSCameraUsageDescription**: استخدام الكاميرا
- **NSMicrophoneUsageDescription**: استخدام الميكروفون

## الملفات المعدلة

### 1. `lib/services/permission_service.dart`
خدمة إدارة الأذونات مع الميزات التالية:
- `requestAllPermissions()`: طلب جميع الأذونات المطلوبة
- `hasRequestedPermissions()`: التحقق من طلب الأذونات سابقاً
- `hasStoragePermission()`: التحقق من أذونات التخزين
- `hasAllCriticalPermissions()`: التحقق من الأذونات الحرجة

### 2. `lib/screens/permissions_request_screen.dart`
شاشة جديدة لطلب الأذونات تحتوي على:
- واجهة مستخدم جذابة بتصميم عربي
- شرح لكل إذن ولماذا نحتاجه
- زر "منح الأذونات" و "تخطي الآن"
- رسائل توضيحية للمستخدم

### 3. `lib/main.dart`
تم تحديث التطبيق الرئيسي:
- تحويل `BaghdanSportsApp` إلى `StatefulWidget`
- التحقق من حالة الأذونات عند بدء التشغيل
- عرض شاشة الأذونات إذا لم يتم طلبها من قبل

### 4. `android/app/src/main/AndroidManifest.xml`
إضافة جميع الأذونات المطلوبة لـ Android

### 5. `ios/Runner/Info.plist`
إضافة أوصاف الأذونات المطلوبة لـ iOS

## كيفية العمل

1. **عند أول تشغيل**:
   - يتحقق التطبيق من حالة الأذونات
   - إذا لم يتم طلبها من قبل، يعرض شاشة الأذونات
   - المستخدم يمكنه منح الأذونات أو تخطيها

2. **بعد منح الأذونات**:
   - يتم حفظ حالة الطلب في SharedPreferences
   - لن تظهر الشاشة مرة أخرى
   - يمكن للمستخدم تغيير الأذونات من إعدادات الجهاز

3. **إذا تم التخطي**:
   - يستمر التطبيق في العمل
   - بعض الميزات قد لا تعمل بدون الأذونات
   - يمكن طلب الأذونات لاحقاً عند الحاجة

## الاختبار

### اختبار Android
```bash
# حذف بيانات التطبيق لمحاكاة أول تشغيل
adb shell pm clear com.example.baghdan_sports

# تشغيل التطبيق
flutter run
```

### اختبار iOS
```bash
# حذف التطبيق من المحاكي
# ثم تشغيله مرة أخرى
flutter run
```

## ملاحظات مهمة

1. **Android 13+**: يستخدم أذونات منفصلة للصور والفيديوهات
2. **iOS**: يجب أن تكون الأوصاف واضحة ومفهومة
3. **SharedPreferences**: يتم استخدامها لتتبع حالة طلب الأذونات
4. **التخطي**: المستخدم يمكنه تخطي الأذونات والمتابعة

## الميزات المستقبلية

- [ ] إضافة إعدادات لإعادة طلب الأذونات
- [ ] تحسين رسائل الخطأ عند رفض الأذونات
- [ ] إضافة دليل مصور لمنح الأذونات يدوياً
- [ ] دعم أذونات إضافية حسب الحاجة
